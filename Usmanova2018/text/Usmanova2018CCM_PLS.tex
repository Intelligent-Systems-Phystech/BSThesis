\documentclass[14pt]{article}
%\documentclass[14pt]{disser}

\pagestyle{empty}
\usepackage[utf8]{inputenc}
\usepackage[T2A]{fontenc}
\usepackage[russian]{babel}
\usepackage{cmap}
\usepackage{amsthm}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{hyperref}
\usepackage{slashbox}
\usepackage{mathtools}
\usepackage{graphicx}
\usepackage{float}
%\usepackage{geometry}
\usepackage{bm}
\usepackage{multicol}
\usepackage{makecell}
\usepackage{titling}
\usepackage{footnote}
\usepackage{lipsum}
\pagestyle{empty}
\usepackage{multibib}

\usepackage[thinlines]{easytable}

%\geometry{margin=1cm}

\usepackage[a4paper, mag=1000, includefoot, left=3cm, right=2cm, top=2cm, bottom=1.5cm, headsep=1cm, footskip=1cm]{geometry}
\renewcommand{\baselinestretch}{1.5}

%--------------------------------------

\usepackage[labelfont=bf]{caption}
\captionsetup[table]{labelsep=space, 
        justification=raggedright, singlelinecheck=off}
\usepackage{threeparttable}

%--------------------------------------

%-----------------------------------

\newcommand{\bE}{\mathbf{E}}
\newcommand{\bF}{\mathbf{F}}
\newcommand{\bH}{\mathbf{H}}
\newcommand{\bI}{\mathbf{I}}
\newcommand{\bM}{\mathbf{M}}
\newcommand{\bP}{\mathbf{P}}
\newcommand{\bQ}{\mathbf{Q}}
\newcommand{\bT}{\mathbf{T}}
\newcommand{\bR}{\mathbf{R}}
\newcommand{\bW}{\mathbf{W}}
\newcommand{\bX}{\mathbf{X}}
\newcommand{\bY}{\mathbf{Y}}
\newcommand{\bZ}{\bold{Z}}

\newcommand{\bh}{\mathbf{h}}
\newcommand{\bp}{\mathbf{p}}
\newcommand{\bq}{\mathbf{q}}
\newcommand{\bt}{\mathbf{t}}
\newcommand{\bx}{\mathbf{x}}
\newcommand{\by}{\mathbf{y}}
\newcommand{\bz}{\mathbf{z}}



%\makeatletter
%\let\@fnsymbol\@arabic
%\makeatother


%\title{{\bf Модели обнаружения зависимостей во временных рядах в задачах построения прогностических моделей}\vspace{-7ex}}
%\date{}

\begin{document}
%\maketitle

{
\renewcommand{\baselinestretch}{1}
\thispagestyle{empty}
\begin{center}
    \sc
        Министерство науки и высшего образования \\ 
        Российской Федерации\\
        <<Московский физико-технический институт \\
        {(государственный университет)}>>\\
		Физтех-школа прикладной математики и информатики \\        
        Факультет управления и прикладной математики\\
        Кафедра <<Интеллектуальные системы>>\\[35mm]
    \rm\large
        Усманова Карина Равилевна\\[10mm]
    \bf\Large
        Модели обнаружения зависимостей во временных рядах в задачах построения прогностических моделей\\[10mm]
    \rm\normalsize
        03.04.01- Прикладные математика и физика\\[10mm]
    \sc
        Выпускная квалификационная работа\\
        (бакалаврская диссертация)\\[30mm]
\end{center}
\hfill\parbox{80mm}{
    \begin{flushleft}
    \bf
        Научный руководитель:\\
    \rm
    	д. ф.-м. н. Стрижов Вадим Викторович\\[5cm]
    \end{flushleft}
}
\begin{center}
    Москва\\
    2018 г.
\end{center}
}

\newpage
\begin{abstract}
При прогнозировании сложноорганизованных временных рядов, зависящих от экзогенных факторов и имеющих множественную периодичность, требуется решить задачу выявления связанных рядов. 
Предполагается, что добавление этих рядов в модель повышает качество прогноза. 
Статистическая значимость повышения качества прогноза выявляется в с помощью теста Гренджера. 
В данной работе для обнаружения связей между временными рядами предлагается использовать метод сходящегося перекрестного отображения. 
При таком подходе два временных ряда считаются зависимыми, если существует отображение окрестности фазовой траектории из одного лагированного пространства в другое.  
Также при обнаружении причинно-следственных связей между временными рядами ставится задача обнаружения оптимального лагированного подпространства. 
Решение этой задачи продемонстрировано на двух парах рядов: потребления электроэнергии и температура,  объема железнодорожных перевозок нефти и цена на нефть.
\end{abstract}
\textbf{Ключевые слова}: \textit{временные ряды; прогнозирование; тест гренджера; сходящиеся перекрестные отображения; оптимальное лагированное подпространство}


\newpage
\tableofcontents

\newpage
\section{Введение}
Работа посвящена обнаружению причинно-следственных связей между разнородными временным рядами. 	
Примеры зависимых разнородных временных рядов:
связь эконометрических временных рядов, cвязь показателей ЭКГ и пульса (\url{http://smartlab.ws/component/content/article?id=60})

Если прогноз временного ряда $\bx$ строится с использованием временных рядов $\by_1, \ldots, \by_k$, то установление связей ряда $\bx$ с $\by_1, \ldots, \by_k$ может повысить качество прогноза и упростить прогностическую модель. 
Если установлено, что ряд $\bx$ не  зависит от ряда $\by_i$, то $\by_i$ можно исключить из прогностической модели.
В данной работе для обнаружения зависимостей между рядами в работе анализируются два подхода: тест Гренджера \cite{granger1969investigating, barrett2010multivariate} и метод сходящегося перекрестного отображения (convergent cross mapping, CCM) \cite{sugihara2012detecting, sugihara1990nonlinear}. 

В основе теста Гренджера лежит следующий подход.
Считаем, что ряд~${\bf x}$ зависит от ряда~${\bf y}$ (или следует из ряда~${\bf y}$), если использование истории ряда~${\bf y}$ при построении прогностической модели статистически значимо повышает качество прогноза ряда~${\bf x}$, \cite{granger1969investigating, barrett2010multivariate}.
Тест Гренджера позволяет установить связи между рядами и основан на сравнении качества прогноза, в котором используется история только прогнозируемого ряда, и прогноза, который дополнительно использует историю других рядов. Если улучшение качества прогноза подтверждается статистически, то говорят, что прогнозируемый ряд связан с использовавшихся во втором прогнозе рядов. 
Тест Гренджера  применим к стационарным временным рядам, поэтому в случае нестационарных рядов их необходимо продифференцировать перед проведением теста Гренджера.  
Тест Гренджера используется в различных задачах, в котрых необходимо исследовать взаимосвязь между развивающимися во времени процессами \cite{hiemstra1994testing, hoffmann2005fdi}.    

Недостатком теста Гренджера является то, что при используемом в нем подходе невозможно точно определить структуру зависимости рядов. Например, два ряда могут следовать из третьего, но при отсутствии информации о третьем ряде тест Грернджера установит причинно-следственную связь между первым и вторым рядом, хотя она отсутствует. Проблема точного определения структуры зависимости рядов рассмотрена в работе \cite{white2010granger}. 

В случае, когда тест Гренджера неприменим или не может обнаружить связь между рядами, применяется метод сходящегося перекрестного отображения (convergent cross mapping, CCM). Этот метод основан на оценке того, насколько хорошо один ряд может быть восстановлен и использованием второго. Считается, что ряд $\bx$ точно восстанавливается по ряду $\by$, только если ряд $\by$ влияет на ряд $\bx$. Метод CCM основан на сравнении ближайших соседей в траекторном пространстве ряда $\bx$, полученных с помощью ряда $\bx$ и с помощью ряда $\by$. Другими словами, проверяется, насколько точно моменты времени, соответствующие ближайшим соседям вектора~$\by_t$, определяют ближайших соседей вектора~$\bx_t$.
\cite{sugihara2012detecting, sugihara1990nonlinear}.

При построении  линейной прогностической модели по временному ряду строится траекторная  матрица, играющая роль матрицы объектов.  Ответами являются значения ряда в последующие моменты времени. Иногда размерность траекторного пространства очень велика, и, как следствие,  прогностическая модель становится неустойчивой. В этом случае необходимо производить отбор признаков \cite{katrutsa2015stress, li2017feature}. Метод проекций на латентные структуры (partial least squares, PLS) отбирает наиболее значимые признаки и строит новые признаки как их линейные комбинации \cite{geladi1988notes, hoskuldsson1988pls}. Таким образом, PLS находит подпространство траекторного пространства, проекция в которое наилучшим образом приближает исходный ряд. 
Снижение размерности может применяться при изучении связей между рядами.
Проекции в траекторное подпространство позволяет более детально изучить связь между главными компонентами рядов и найти подпространство, в котором наблюдается связь между рядами.

В данной работе для построения прогноза одного временного ряда по нескольким используется алгоритм многомерной гусеницы (multivariate singular spectrum analysis, MSSA-L)~\cite{golyandina2005ssa}. 
Этот алгоритм является обобщением на многомерный случай алгоритма анализа спектральных компонен (singular spectrum analysis, SSA) \cite{golyandina2001analysis, golyandina2013singular, elsner2013singular}. 
Метод SSA основан на разложении временного ряда в сумму интерпретируемых компонент. Он делится на четыре основных шага: запись ряда в виде траекторной  матрицы, ее сингулярное разложение, группировка компонент полученных при сингулярном разложении, по каждой сгруппированной матрице восстанавливается временной ряд. Таким образом исходный временной ряд представляется в виде суммы временных рядов.
Метод SSA применяется в таких задачах, как выявления трендов  во временных рядах \cite{alexandrov2008method}, подавления шума во временных рядах \cite{allen1996monte}, прогнозирование временных рядов \cite{hassani2013forecasting, marques2006singular}. 

 




\section{Постановка задачи прогнозирования} 
Поставим задачу прогноза многомерного временного ряда.

Обозначим~${\bf X} = \left[{\bf x}^{(1)}, \ldots ,{\bf x}^{(s)}\right]^{\mathsf{T}}$ -- заданный~$s$-мерный временной ряд. 
%Возьмем в качестве обучающей выборки~${\bf X}_{\text{train}}$ подотрезок ряда~${\bf X}$  от~${\bf X}_{0}$, до~${\bf X}_{n - 1}$. 
%Тогда обучающая выборка имеет вид 
Построим матрицу плана из сегментов ряда:
\begin{equation}\label{X_multidim}
\begin{pmatrix}
x^{(1)}_{0} & \ldots & x^{(1)}_{n - 1} \\ 
\vdots \\ 
x^{(s)}_{0} & \ldots & x^{(s)}_{n - 1}
\end{pmatrix} = {\bf X}_{0 \div (n - 1)}.
\end{equation}

Пусть~${\bf X}_n = \left[ x^{(1)}_n, \ldots x^{(s)}_n\right]^{\mathsf{T}}$ -- значение ряда~${\bf X}$ в момент времени~$n$.
Построим прогноз~${\bf \hat{X}}$ ряда~${\bf X}$ в точке~${\bf X}_{n}$. Проделаем это~$k$ раз для различных обучающих выборок~${\bf X}_{\text{train}}^i = {\bf X}_{i \div (n + i - 1)}, \, {i = 0, \ldots, (k - 1)}$.
Получим~$k$ прогнозов ${\bf \hat{X}} = \left[{\bf \hat{X}}_n, {\bf \hat{X}}_{n + 1}, \ldots {\bf \hat{X}}_{n + k - 1} \right]$ ряда~${\bf X}$ в точках ${\bf X}_n, {\bf X}_{n + 1}, \ldots {\bf X}_{n + k - 1}$.

Прогностическая модель имеет вид
$$\hat{{\bf X}}_{t + 1} = {\bf f}(\hat{\textbf{w}}, {\bf X}_t, {\bf X}_{t-1}, \ldots, {\bf X}_{t - L + 2}),$$ 
$$\hat{\textbf{w}} = \text{arg}\min_{\textbf{w}}{S(\textbf{w}, {\bf X}, {\bf \hat{X}}_n, {\bf \hat{X}}_{n + 1}, \ldots {\bf \hat{X}}_{n + k - 1} )} = 
{S(\textbf{w}, {\bf X}, {\bf \hat{X}})},$$
где функция потерь 
$$S(\textbf{w}, {\bf X}, {\bf \hat{X}}) = \sum_{i = 0}^{k - 1}{\mathcal{L}({\bf X}_{n + i}, {\bf \hat{X}}_{n + i})} = \sum_{i = 0}^{k - 1}{\mathcal{L}({x}^{(1)}_{n + i}, {\hat{x}}^{(1)}_{n + i})}.$$


\section{Обнаружение связей временных рядов}\label{granger_test}
\paragraph{Тест Гренджера.}
В качестве базового метода установления связей предлагается использовать статистический тест Гренджера. Ниже приведен алгоритм теста Гренджера для проверки наличия связи двух временных рядов.  
Требуется проверить, зависит ли ряд~${\bf x}$ от ряда~${\bf y}$. Выдвинем гипотезу о независимости ряда~${\bf x}$ от ряда~${\bf y}$ и проверим ее. Делаем это следующим образом.

\begin{enumerate}
\item Строим прогноз ряда~${\bf x}$ без использования ряда~${\bf y}$ и находим значение функции потерь
$$S_{{\bf x}} = \sum_{i = 1}^{n}{\mathcal{L}\left( {x}_i, \hat{x}_i \right)},$$
где~$n$ -- длина тестовой выборки. 

Функцию~$\mathcal{L}({x}, \hat{{x}})$ выбираем в зависимости от распределения ошибок прогноза на тестовой выборке. 

\item Строим прогноз ряда~${\bf x}$ с использованием ряда~${\bf y}$. Вычисляем для него значение функции потерь
$$S_{\bf xy} = \sum_{i = 1}^{n}{\mathcal{L}\left( {x}_i, \hat{{x}}_i \right)}.$$

\item Рассмотрим статистику 
$$T({\bf x}, {\bf y}) = \frac{N - 2k}{k} \cdot \frac{S_{\bf x} - S_{\bf xy}}{S_{\bf xy}},$$
где~$N$ -- длина обучающей выборки,~$k$ -- размерность регрессионной модели. 
Статистика~$T$ имеет распределение~$F(k, N - 2k)$ (распределение  Фишера с параметрами~$(k, N - 2k)$).

\item Если ряд~${\bf x}$ не зависит от ряда~${\bf y}$, то значения~$S_{\bf x}$ и~$S_{\bf xy}$ будут близки, а статистика~$T({\bf x}, {\bf y})$~-- незначима. Поэтому в случае больших значений статистики~$T({\bf x}, {\bf y})$ отвергаем гипотезу о независимости ряда~${\bf x}$ от~${\bf y}$. Выберем некоторое критические значение~$t$ статистики~$T({\bf x}, {\bf y})$. Тогда критерий зависимости ряда~${\bf x}$ от ряда~${\bf y}$ выглядит следующим образом:
$$\text{Из } T({\bf x}, {\bf y}) > t \quad \text{следует, что ряд {\bf x} зависит от ряда {\bf y}}$$

\item Аналогично проверим зависимость ряда~${\bf x}$ от восстановленного (с помощью алгоритма MSSA-L) ряда~${\bf \hat{y}}$. 
Для этого используем статистику 
$$T({\bf x}, {\bf \hat{y}}) = \frac{N - 2k}{k} \cdot \frac{S_{\bf x} - S_{\bf x \hat{y}}}{S_{\bf x \hat{y}}}.$$
\end{enumerate}

Для более подробного изучения связи между временными рядами~${\bf x}$ и~${\bf y}$ вычисляем кросс--корреляционную функцию~$\gamma_{{\bf xy}}(h)$
$$\gamma_{{\bf xy}}(h) = \frac{\mathsf{E}\left[ \left({\bf x}_t - \boldsymbol{\mu}_{\bf x}\right)\left({\bf y}_{t + h} - \boldsymbol{\mu}_{\bf y}\right) \right]}{\sigma^2_{\bf x}\sigma^2_{\bf y}},$$
где~$\mathsf{E}$ -- математическое ожидание,~$\boldsymbol{\mu}$ -- выборочное среднее,~$\sigma^2$ -- выборочная дисперсия.
Если~$h^*$ соответствует максимальному значению кросс-корреляции, то говорят, что ряд~${\bf y}$ сдвинут на~$h^*$ относительно~${\bf x}$. 		
Заметим, что если ряд~${\bf x}$ сдвинут на~$h_1$ относительно ряда~${\bf y}$, а ряд~${\bf y}$ сдвинут  на~$h_2$ относительно ряда~${\bf z}$. То ряд~${\bf x}$ сдвинут на~$h_3 = h_1 + h_2$ относительно ряда~${\bf z}$.

Пусть прогноз ряда~${\bf x}$ строится с использованием истории ряда~${\bf y}$ и пусть с помощью  вычисления кросс-корреляции рядов~${\bf x}$ и~${\bf y}$  получено, что ряд~${\bf x}$ отстает от ряда~${\bf y}$ на~$h$ отсчетов времени. Тогда использование  при прогнозе ряда~${\bf y}$, сдвинутого на~$h$ отсчетов назад, может повысить качество прогноза.




\paragraph{Метод сходящегося перекрестного отображения, CCM.}
Опишем, как строится прогноз ряда $\by = \left[y_1, \ldots, y_N\right]$ с помощью ряда $\bx = \left[x_1, \ldots, x_N\right]$. 
Построим матрицу Ганкеля ряда $\bx$.
$$\mathbf{H}_{\bx} = \begin{pmatrix}
x_1 & x_2 & \ldots & x_{L - 1} & x_{L} \\ 
x_2 & x_3 & \ldots & x_{L} & x_{L + 1} \\ 
\vdots & \vdots & & \vdots  & \vdots\\ 
x_{N - L + 1} & x_{N - L + 2} & \ldots & x_{N - 1} & x_{N} \\ 
\end{pmatrix},$$
где $L$ -- ширина окна, длина истории ряда, используемая при нахождении главных компонент. Аналогично строим матрицу $\bH_{\by}$. 
Обозначим $t$-ю строку матрицы $\bH_{\bx}$ через $\bx_{t + L - 1}$ соответственно. Тогда матрица $\bH_{\bx}$ принимает вид 
$$\bH_{\bx} = \begin{pmatrix}
\bx_{L} \\ \vdots \\ \bx_{N}
\end{pmatrix}, \quad \bx_{i} = \left[x_{i - L + 1}, \ldots, x_{i - 1}, x_{i}\right], \quad i = L, \ldots, N.$$ 
Заметим, что все вектора $\bx_L, \ldots, \bx_N$ принадлежат $L$-мерному траекторному пространству $\bM_{\bx}$ ряда $\bx$. 
Аналогично вводим $\by_{t}, t = L, \ldots, N$, лежащие в траекторном пространстве $\bM_{\by}$ ряда $\by$.
Выберем момент $t \in [L, N]$ и найдем $k$  ближайших соседей вектора~$\mathbf{x}_t$ в~$\bM_{\bx}$. Обозначим их индексы через ${t_1}, \ldots, {t_{k}}$. Тогда ближайшие соседи $\mathbf{x}_{t}$ -- это строки матрицы $\bH_{\bx}$ с номерами \mbox{$(t_1 - L + 1), \ldots,(t_{k} - L + 1)$}:
$$\bx_{t_i} = \left[x_{t_{i} - L + 1}, \ldots, x_{t_{i} - 1}, x_{t_i} \right], \quad i = 1 , \ldots, k$$
Прогноз $\hat{y}_t$ строится следующим образом:
$$\hat{y}_t = \sum_{i = 1}^{k}{\text{w}_i y_{t_i}}, \quad  \text{где } t_i \text{-- индексы ближайших соседей } \mathbf{x}_{t}$$
$$\text{w}_i = \frac{u_i}{\sum_{i}u_i}, \quad u_i = \exp{-\left( \dfrac{||\mathbf{x}_t - \mathbf{x}_{t_i}||_2}{||\mathbf{x}_t - \mathbf{x}_{t_{L + 1}}||_2}\right)}$$
Аналогично строится прогноз ряда $\mathbf{X}$ с использованием ряда $\mathbf{Y}$.

Покажем, как описанный подход можно применяется для обнаружения зависимости между рядами. Пусть выбран момент времени $t^*$ и вектор $\bx_{t^*} = \left[x_{t^* - L + 1}, \ldots, x_{t^* - 1}, x_{t^*} \right]$. И пусть $\bx_{t_1}, \ldots, \bx_{t_k}$ -- ближайшие соседи вектора $\bx_{t^*}$. Тогда вектора $\by_{t^*}, \by_{t_1}, \ldots, \by_{t_k}$ -- строки матрицы $\bH_{\by}$, соответствующие индексам $t_1, \ldots, t_k$ . Тогда, если вектора $\by_{t^*}, \by_{t_1}, \ldots, \by_{t_k}$ расположены в $\bM_{\by}$ достаточно близко, то утверждается, что ряд $\bx$ зависит от ряда $\bx$.

Введем меру близости $\by_{t^*}, \by_{t_1}, \ldots, \by_{t_k}$ следующим образом:
$$S(\bx, \by) = \dfrac{\text{dist}(\bx)}{\text{dist}(\by)}, \quad 
\text{dist}(\bx) = \frac{1}{k}\sum_{i = 1}^{k}{||\bx_{t^*} - \bx_{t_i}||_2}$$

Если~$S(\bx, \by)$ меньше некоторого порога~$s$, то ряд~$\by$ зависит от ряда~$\bx$.

Заметим, что можно рассматривать ближайших соседей не во всем траекторном пространстве $\bM_{\bx}$ и $\bM_{\by}$, а только в некотором его подпространстве, натянутом на первые главные компоненты. Пусть сингулярное разложение матрицы $\bH_{\bx}$ имеет вид
\newcommand{\bV}{\bold{V}}
\newcommand{\bU}{\bold{U}}
\newcommand{\bLambda}{\mathbf{\Lambda}}
\newcommand{\cT}{\mathcal{T}}

$$\bH_{\bx} = \bU_{\bx}\bLambda_{\bx}\bV_{\bx}$$

Пусть $\cT_{\bx}$ -- некоторый набор индексов компонент ряда $\bx$.
Построим проекцию ряда~$\bx$ на подпространство, натянутое на компоненты с номерами из $\mathcal{T}_{\bx}$. Обозначим это подпространство $\bM_{\cT_{\bx}}$.
Заменим в матрице $\bLambda_{\bx}$ элементы, находящиеся в строках с 
индексами, не из $\cT_{\bx}$, нулями. Обозначим полученную матрицу $\tilde{\bLambda}_{\bx}$.
Тогда проекция ряда $\bx$ в подпространство, натянутое на компоненты с индексами из $\cT_{\bx}$ задается траекторной матрицей
$$\bP_{\cT_{\bx}} = \bU_{\bx}\tilde{\bLambda}_{\bx}\bV_{\bx}.$$
Аналогично по некоторому набору $\cT_{\by}$ строится подпространство $\bM_{\cT_{\by}}$ и траекторная матрица $\bP_{\cT_{\by}}$. 
Далее предлагается искать ближайших соседей не в полных траекторных пространствах $\bM_{\bx}$ и $\bM_{\by}$, задающихся траекторными матрицами $\bH_{x}$ и $\bH_{\by}$ соответственно, а в подпространствах $\bM_{\cT_{\bx}}$ и $\bM_{\cT_{\by}}$, задающихся матрицами $\bP_{\cT_{\bx}}$ и $\bP_{\cT_{\by}}$. 

Рассмотрев различные подпространства, можно выбрать то, которое будет наилучшим образом описывать исследуемый временной ряд и  будет иметь минимальную размерность.  Перебор различных подпространств также позволяет установить, между какими именно компонентами рядов $\bx$ и $\by$ существует зависимость. 

Зависимость рядов в выбранных подпространствах устанавливается аналогично зависимости в полных пространствах $\bM_{\bx}$ и $\bM_{\by}$.  
Пусть $\cT_{\bx}$ и $\cT_{\by}$ -- наборы индексов главных компонент рядов  $\bx$ и $\by$ соответственно.
Тогда $\bP_{\cT_{\bx}}$ и $\bP_{\cT_{\by}}$ -- траекторные матрицы проекций рядов $\bx$ и $\by$ в подпространства, натянутые на $\cT_{\bx}$ и $\cT_{\by}$ соответственно. 
Для фиксированного $t^*$ находим $k$ ближайших соседей $\bx_{t_1}, \ldots, \bx_{t_k}$ и соответствующие им $\by_{t^*}, \by_{t_1}, \ldots, \by_{t_k}$. Здесь $\bx_{t}$ и $\by_{t}$ -- строки матриц $\bP_{\cT_{\bx}}$ и $\bP_{\cT_{\by}}$ соответственно. 

Будем перебирать различные комбинации индексов главных компонент и соответствующие им подпространства $\bM_{\cT_{\bx}}$ и $\bM_{\cT_{\by}}$. Для каждой пары $\left(\mathcal{T}_{\bx}, \mathcal{T}_{\by}\right)$ индексов главных компонент рядов $\bx$ и $\by$ соответственно будем находить среднее расстояние между $k$ ближайшими соседями для ряда $\bx$ и между ближайшими соседями для ряда $\by$. Введем меру близости векторов 
\begin{equation}\label{eq:Sxy}
S(\bx, \by, \mathcal{T}_{\bx}, \mathcal{T}_{\by}) = \dfrac{\text{dist}(\bx, \mathcal{T}_{\bx})}{\text{dist}(\by, \mathcal{T}_{\by})}, \quad 
\text{dist}(\bx, \mathcal{T}_{\bx}) = \frac{1}{k}\sum_{i = 1}^{k}{||\bx_{t^*} - \bx_{t_i}||_2}
\end{equation}

Тогда задача поиска подпространств $\bM_{\cT_{\bx}}$ и $\bM_{\cT_{\by}}$ эквивалентна поиску номеров главных компонент $\left(\cT_{\bx}, \cT_{\by} \right)$ и имеет вид
\begin{equation}\label{eq:argmax}
\begin{aligned}
\left(\cT_{\bx}, \cT_{\by} \right) = \text{arg}\max_{\cT_{\bx}, \cT_{\bx}}S(\bx, \by, \mathcal{T}_{\bx}, \mathcal{T}_{\by}), \\
\end{aligned}
\end{equation}
\vspace{-3mm}
\begin{equation*}
\begin{aligned}
|\cT_{\bx}| \to \min, \\ 
|\cT_{\by}| \to \min 
\end{aligned}
\end{equation*}


\section{Алгоритм многомерной гусеницы (MSSA-L)}
В данной работе в качестве прогностической модели~${\bf f}$ $s$-мерного ряда ${\bf X} = \left[{\bf x}^{(1)}, \ldots ,{\bf x}^{(s)}\right]^{\mathsf{T}}$  используется алгоритм многомерной гусеницы~(MSSA-L). 	Функция~${\bf f}$ имеет вид:
$$ {\bf f}(\hat{\textbf{w}}, {\bf x}_t, {\bf x}_{t-1}, \ldots, {\bf x}_{t - L + 2}) = \begin{pmatrix}
x^{(1)}_{t - L + 2} & \ldots & x^{(1)}_{t} \\
x^{(2)}_{t - L + 2} & \ldots & x^{(2)}_{t} \\ 
&\vdots& \\ 
x^{(s)}_{t - L + 2} & \ldots & x^{(s)}_{t}
\end{pmatrix} \cdot \mathbf{p}.$$
вектор коэффициентов~$\mathbf{p}$ определяется алгоритмом многомерной гусеницы MSSA-L. Алгоритм MSSA-L подробнее описан в следующем разделе.

Алгоритм MMSA-L является обобщением на многомерный случай алгоритма гусеницы (SSA). Задача алгоритма MSSA-L состоит в представлении временного ряда в виде суммы интерпретируемых компонент. 
Это осуществляется в четыре шага: запись ряда в виде траекторной матрицы, сингулярное разложение этой матрицы, группировка компонент, полученных при сингулярном разложении, в интерпретируемые компоненты и восстановление временного ряда по каждой из интерпретируемых компонент. 

%Пусть дан~$s$-мерный временной ряд длины~$N$:
%$${\bf X} = \begin{pmatrix}
%x^{(1)}_0 & \ldots & x^{(1)}_{N - 1} \\ 
%& \vdots & \\ 
%x^{(s)}_0 & \ldots & x^{(s)}_{N - 1} 
%\end{pmatrix} = \begin{pmatrix} {\bf x}^{(1)} \\ \vdots \\ {\bf x}^{(s)} \end{pmatrix},$$
%где~${\bf x}^{(i)} = \left( x^{(i)}_{0}, \ldots, x^{(i)}_{N - 1}\right)$ -- одномерный временной ряд длины~$(N - 1)$.

По ряду \eqref{X_multidim} построим матрицу Ганкеля $\mathbf{H} \in \mathbb{R}^{L \times sK}, \, K = N - L + 1$:
$$\mathbf{H} = [\mathbf{H}_{1}, \mathbf{H}_{2}, \ldots, \mathbf{H}_{s}],$$
где~$L$ -- ширина окна,~$\mathbf{H}_{i} \in \mathbb{R}^{L \times K}$ -- матрица Ганкеля для ряда~${\bf x}^{(i)},$
$$\mathbf{H}^{(i)} = \begin{pmatrix}
x^{(i)}_{0} & x^{(i)}_{1} &\ldots & x^{(i)}_{N - L} \\
x^{(i)}_{1} & x^{(i)}_{2} &\ldots & x^{(i)}_{N - L + 1} \\ 
&&\vdots& \\ 
x^{(i)}_{L - 1} & x^{(i)}_{L} &\ldots & x^{(i)}_{N - 1}
\end{pmatrix}.$$

По матрице Ганкеля~$\mathbf{H}$ можно восстановить временной ряд~${\bf X}$. 
Метод многомерной гусеницы строит 
приближение $\hat{\mathbf{H}}$ матрицы~$\mathbf{H}$ меньшего ранга с помощью сингулярного разложения этой матрицы и восстанавливает ряд по матрице~$\hat{\mathbf{H}}$.
Сингулярное разложение матрицы~$\mathbf{H}$ имеет вид
$$\mathbf{H} = \mathbf{U}\mathbf{\Lambda} \mathbf{V} = \sum_{i = 1}^{d}{\lambda_i \mathbf{u}_i\mathbf{v}_i^{\mathsf{T}}}$$
где~$\lambda_1, \ldots, \lambda_d > 0$ -- сингулярные числа матрицы~$\mathbf{H}$,~$\mathbf{u}_i$ и~$\mathbf{v}_i$ -- столбцы матриц~$\mathbf{U}$ и~$\mathbf{V}$.
Тогда наилучшее приближение матрицы~$\mathbf{H}$ матрицей ранга~$r < d$ имеет вид : 
$$\hat{\mathbf{H}} = \sum_{i = 1}^{r}{\lambda_i \mathbf{u}_i \mathbf{v}_i^{\mathsf{T}}}$$

По матрице~$\hat{\mathbf{H}}$ восстанавливается временной ряд~${\bf X}$ путем усреднения элементов, стоящих на антидиагоналях. 

Алгоритм многомерной гусеницы также позволяет построить прогноз временного ряда в момент~$N$ по~$(L - 1)$ предыдущим значениям ряда. 
Алгоритм находит такой вектор коэффициентов~$\mathbf{p} \in \mathbb{R}^{(L - 1)}$, что значения ряда~${\bf X}$ в момент~$N$:
\begin{equation}
{\bf x}_N = \begin{pmatrix}
x^{(1)}_{N - L + 1} & \ldots & x^{(1)}_{N - 1} \\
x^{(2)}_{N - L + 1} & \ldots & x^{(2)}_{N - 1} \\ 
&\vdots& \\ 
x^{(s)}_{N - L + 1} & \ldots & x^{(s)}_{N - 1}
\end{pmatrix} \cdot \mathbf{p} = \mathbf{Y} \cdot \mathbf{p}
\end{equation}
Заметим, что коэффициенты~$\mathbf{p}$ оказываются общими для всех компонент ряда~${\bf X}$.


Для каждого~$i \in [1, r]$ обозначим~$\tilde{\mathbf{u}}_i$ первые~$(L - 1)$ компонент столбца~$\mathbf{u}_i$,~$\pi_i$ -- последнюю компоненту столбца~$\mathbf{u}_i$ и~$\nu = \sum_{i = 1}^{r}{\pi_i^2}$. Тогда вектор коэффициентов~$\mathbf{p}$ вычисляется по формуле:
\begin{equation}
\mathbf{p} = \frac{1}{1 - \nu^2}\sum_{i = 1}^{r}{\pi_i\tilde{\mathbf{u}}_i}
\end{equation}

Заметим, что для одномерного временного ряда справедливы все приведенные соотношения при~$s = 1$.

\newcommand{\bTheta}{\mathbf{\Theta}}
\section{Метод проекций на латентные структуры}
Пусть поставлена задача построения прогноза временного ряда $\bx$ на несколько моментов вперед.
Пусть $\bX \in \mathbb{R}^{m \times n}$ -- траекторная матрица ряда $\bx$,   $\bY \in \mathbb{R}^{m \times r}$ -- значения ряда в последующие моменты времени. Предполагается, что между строками матриц $\bX$ и $\bY$ существует линейная зависимость:
$$\bY_{i} = \bX_{i} \cdot \bTheta + \bm{\varepsilon},\quad \bX_{i} \in \mathbb{R}^{n},\; \bY_{i} \in \mathbb{R}^{r}, \; i = 1, \ldots m, $$
где $\bTheta$ -- матрица параметров модели, 	$\bm{\varepsilon}$ -- вектор ошибок прогноза. 

Ошибка прогноза вычисляется следующим образом:
$$S(\Theta, \mathbf{X}, \mathbf{Y}) = ||\mathbf{Y} - \mathbf{X}\cdot\bTheta||^2_2 = \sum_{i = }^{}{||\bY_i - \bX_i\cdot\bTheta||^2_2}$$ 

Для нахождения параметров модели $\bTheta$ используется метод проекций на латентные структуры PLS.  Алгоритм PLS находит в латентном пространстве матрицу $\mathbf{T} \in \mathbb{R}^{m \times l}$, наилучшим образом описывающую матрицы $\mathbf{X}$ и $\mathbf{Y}$. Матрицы $\mathbf{X}$ и $\mathbf{Y}$ проецируются в латентное пространство следующим образом:

$$\bX = \bT \cdot \bP^{{T}} + \bF= \sum_{k = 1}^{l}{\bt_k\cdot \bp_k^{\mathsf{T}} + \bF}$$

$$\bY = \bT \cdot \bQ^{{T}} + \bE= \sum_{k = 1}^{l}{\bt_k\cdot \bq_k^{\mathsf{T}} + \bE}$$
где $\bT$~--- матрица совместного описания объектов и ответов в латентном пространстве, причём столбцы матрицы $\bT$ ортогональны; $\bP,\ \bQ$~--- матрицы перехода из латентного пространства в  исходные пространства; $\bE,\ \bF$~--- матрицы невязок.
Алгоритм PLS находит матрицы $\bT, \bP, \bQ$, а также такую матрицу $\bW$, что параметры модели можно вычислить по формуле 
$$\Theta = \bW (\bP^{\mathsf{T}} \bW)^{-1} \bQ^{\mathsf{T}}$$

\section{Вычислительный эксперимент}
\subsection{Сгенерированные данные}
Эксперимент проводился на двух сгенерированных рядах $\bx$ и $\bx$:
$$\bx = \sin t + 2\sin\frac{t}{2} + \sigma^2_x\bm{\varepsilon}, \quad \sigma^2_x = 0.3$$
$$\by = \sin(2t + 5) + \sigma^2_y\bm{\varepsilon}, \quad \sigma^2_y = 0.25,$$
где $\bm{\varepsilon} \in \mathcal{N}(\bold{0}, \bI)$

Строим матрицу Ганкеля $\bH_{\bx}$ по ряду $\bx$, взяв ширину окна $L = 250$. Для некоторого момента времени $t^*$ рассмотрим вектор $\bx_{t^*}$, равный $t^*$-й строке матрицы $\bH_{\bx}$. Выберем $k$ и найдем среди строк матрицы $\bH_{\bx}$ $k$ ближайших (в смысле евклидовой нормы) соседей вектора $\bx_{t^*}$. Обозначим индексы найденных векторов $t_1, \ldots, t_k$, а сами найденные вектора -- $\bx_{t_1}, \ldots, \bx_{t_k}$. 

На рисунке изображен ряд $\bx$ и $k = 25$ ближайших соседей для момента $t^* = 15$. Моменты времени $t_1, \ldots, t_{k}$ выделены красным, момент $t^*$ -- черным. 

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.45]{pictures/generated_data/X_sin_knn.eps}
\end{center}
\vspace{-5mm}
\caption{Ближайшие соседи точки $\bx_{15}$}
\end{figure}

Строим матрицу Ганкеля $\bH_{\by}$ по ряду $\bx$. 
Обозначим $i$-ю строку $\bH_{\by}$ через $\by_{i}$. Тогда по найденным индексам $t_1, \ldots, t_{k}$ можно отобрать соответствующие $\by_{t_1}, \ldots, \by_{t_{k}}$. Если ряд $\bx$ зависит от ряда $\bx$, то вектора $\by_{t_1}, \ldots, \by_{t_{k}}$, как и $\bx_{t_1}, \ldots, \bx_{t_{k}}$,  будут находиться рядом в траекторном пространстве.
Изобразим $\bx_{t^*}, \bx_{t_1}, \ldots, \by_{t_{k}}$ и $\by_{t^*}, \bx_{t_1}, \ldots, \by_{t_{k}}$ на фазовых траекториях. 

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.43]{pictures/generated_data/phase_tr_by_X.eps}
\end{center}
\vspace{-3mm}
\caption{Точки на фазовых траекториях  рядов $\bx$ и $\by$, соответствующие 25-ти ближайшим соседям~$\bx_{15}$}
\end{figure}

Видно, что точки обоих фазовых траекториях расположены близко друг другу. Значит, ряд $\bx$ зависит от ряда $\bx$.

Аналогично для некоторого $t^*$ находим ближайших соседей вектора $\by_{t^*}$. Обозначим их $\by_{t_1}, \ldots, \by_{t_k}$. На рис. \ref{sin_y_knn} изображен ряд $\bx$ и $k = 25$ ближайших соседей вектора $\by_{20}$. 

\begin{figure}
\begin{center}
\includegraphics[scale=0.45]{pictures/generated_data/Y_sin_knn.eps}
\caption{Ближайшие соседи точки $\by_{20}$}
\label{sin_y_knn}
\end{center}
\end{figure}

Изобразим $\by_{t^*}, \by_{t_1}, \ldots, \by_{t_{k}}$ и соответствующие им $\bx_{t^*}, \bx_{t_1}, \ldots, \bx_{t_{k}}$ на фазовых траекториях \mbox{(рис. \ref{phase_tr_by_Y})}. 


\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.45]{pictures/generated_data/phase_tr_by_Y.eps}
\caption{Точки на фазовых траекториях  рядов $\bx$ и $\by$, соответствующие 25-ти ближайшим соседям~$\by_{20}$}
\label{phase_tr_by_Y}
\end{center}
\end{figure}

Видим, что точки $\bx_{t^*}, \bx_{t_1}, \ldots, \bx_{t_{15}}$ расположены на фазовых траекториях близко друг к другу. При этом они распадаются на четыре плотные группы. Это связано с тем, что период ряда $\bx$ в четыре раза меньше периода ряда $\bx$.


\subsection{Эксперимент на данных потребления электроэнергии и температуры}\label{section_energy_temp}

В эксперименте исследуются ряд объема потребления электроэнергии $\bx$ и ряд значений температуры~$\bx$ в течение года. Так как эти ряды не являются стационарными, их необходимо продифференцировать и отнормировать  перед тем, как исследовать зависимости между ними. 
Ряд температуры будем приводить к стационарной форме следующим образом. Рассмотрим ряд длины светового дня в течение года $\bz$. С помощью вычисления кросс-корреляционной функции $\gamma_{\bx\by}(h)$ рядов $\bx$ и $\bz$.  Определим, насколько ряд $\bz$ опережает ряд $\bx$. То есть найдем такое $h^*$, что $\bx(t + h^*) = \bz(t)$. Вычтем из ряда $\bx$ ряд $\bz$ с учетом сдвига $h^*$. Полученный ряд $\bx(t) = \bx(t) - \bz(t - h^*)$ будет стационарным рядом температуры. 

Исходные ряды потребления электроэнергии $\bx$, температуры $\bx$ и длины светового дня $\bz$ изображены на рис. \ref{energy_temp_day_len_ts}.

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.45]{pictures/energy_temp/energy_temp_daylen_ts.eps}
\end{center}
\vspace{-5mm}
\caption{Нормированные ряды потребления электроэнергии, температуры и длины светового дня}
\label{energy_temp_day_len_ts}
\end{figure}

Построим кросс-корреляционную диаграмму рядов $\bx$ и $\bz$.
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.45]{pictures/energy_temp/cross_corr_diagram.eps}
\end{center}
\caption{Кросс-корреляционная диаграмма для ряда температуры $\bx$ и длины светового дня $\bz$}
\label{cross_corr_YZ}
\end{figure}


Максимум модуля кросс--корреляции $\gamma_{\by\bz}(h)$ достигается при $h = 560$. Значит, $$\bz(t) = \bx(t + 560).$$
И новый стационарный ряд температуры имеет вид $$\bx^*(t) = \bx(t) - \bz(t - 560).$$
Далее, для удобства, полученный ряд температуры~$\bx^*$ будем обозначать~$\bx$.
Продифференцированные и нормированные ряды потребления электроэнергии и температуры  изображены на рис. \ref{energy_temp_ts}.


\begin{figure}
\begin{center}
\includegraphics[scale=0.45]{pictures/energy_temp/energy_temp_ts.eps}
\caption{Продифференцированные и нормированные ряды потребления электроэнергии и температуры}
\label{energy_temp_ts}
\end{center}
\end{figure}

Исследуем зависимость ряда температуры~$\by$ от ряда потребления электроэнергии~$\bx$. Делаем это аналогично эксперименту на искусственных данных. Выбираем ширину окна~$L$ и некоторый момент времени~$t^*$. Находим~$k$ ближайших соседей векторов $\bx_{t^*}$ и $\by_{t^*}$ и их расположение в траекторном пространстве. 

%--------------- by X ------------------------------
Возьмем $L = 170$, что соответствует периоду в семь дней. 
Возьмем $t^* = 400$. На рис.  \ref{X400_L170_knn} красным показаны ближайшие соседи вектора $\bx_{t^*}$
 
\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.43]{pictures/energy_temp/X_knn_L170.eps}
\vspace{-3mm}
\caption{Ближайшие соседи вектора $\bx_{t^*}$, ширина окна $L = 170$
\label{X400_L170_knn}}
\end{center}
\end{figure}


\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.45]{pictures/energy_temp/by_X_L170_12.eps}
\vspace{-3mm}
\caption{Вектора $\bx_{t^*}, \bx_{t_1}, \ldots, \bx_{t_k}$ (ближайшие соседи вектора $\bx_{t^*}$)  и соответствующие вектора $\by_{t^*}, \by_{t_1}, \ldots, \by_{t_k}$ на фазовых диаграммах с периодом~12 часов}
\end{center}
\end{figure}

\vspace{-4mm}

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.45]{pictures/energy_temp/by_X_L170_24.eps}
\vspace{-3mm}
\caption{Вектора $\bx_{t^*}, \bx_{t_1}, \ldots, \bx_{t_k}$ (ближайшие соседи вектора $\bx_{t^*}$) и соответствующие вектора $\by_{t^*}, \by_{t_1}, \ldots, \by_{t_k}$ на фазовых диаграммах с периодом~24 часа}
\end{center}
\end{figure}

%--------------- by Y ------------------------------

Исследуем зависимость ряда~$\bx$ от ряда~$\by$. Возьмем~$t^* = 400$, ${L = 170}$. На рис.  \ref{Y400_L170_knn} красным показаны ближайшие соседи вектора~$\by_{t^*}$

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.4]{pictures/energy_temp/Y_knn_L170.eps}
\vspace{-4mm}
\caption{Ближайшие соседи вектора $\by_{t^*}$, ширина окна $L = 100$}
\label{Y400_L170_knn}
\end{center}
\end{figure}

\vspace{-5mm}

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.4]{pictures/energy_temp/by_Y_L170_12.eps}
\vspace{-4mm}
\caption{Вектора $\by_{t^*}, \by_{t_1}, \ldots, \by_{t_k}$ (ближайшие соседи вектора $\by_{t^*}$) и соответствующие вектора $\bx_{t^*}, \bx_{t_1}, \ldots, \bx_{t_k}$ на фазовых диаграммах с периодом~12 часов}
\end{center}
\end{figure}

\vspace{-3mm}

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.4]{pictures/energy_temp/by_Y_L170_24.eps}
\vspace{-4mm}
\caption{Вектора $\by_{t^*}, \by_{t_1}, \ldots, \by_{t_k}$ (ближайшие соседи вектора $\by_{t^*}$) и соответствующие вектора $\bx_{t^*}, \bx_{t_1}, \ldots, \bx_{t_k}$ на фазовых диаграммах с периодом~24 часа}
\end{center}
\end{figure}

\subsection{Перебор подпространств}
Переберем траекторные подпространства рядов $\bx$ и $\by$ размера не больше пяти. Для этого будет перебирать пары множеств индексов главных компонент $\left(\cT_{\bx}, \cT_{\by}\right)$. Для каждой пары $\left(\cT_{\bx}, \cT_{\by}\right)$ найдем $S(\bx, \by, \cT_{\bx}, \cT_{\by})$, задающееся \eqref{eq:Sxy}

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.37]{pictures/energy_temp/3d_comps_by_X.eps}
\vspace{-5mm}
\caption{Отношение расстояния между ближайшими соседями ряда $\bx$ к расстоянию между соседями ряда $\by$. Ближайшие соседи определяются по ряду $\bx$}
\end{center}
\end{figure}

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.37]{pictures/energy_temp/3d_comps_by_Y.eps}
\vspace{-5mm}
\caption{Отношение расстояния между ближайшими соседями ряда $\by$ к расстоянию между соседями ряда $\bx$. Ближайшие соседи определяются по ряду $\bx$}
\end{center}
\end{figure}

\subsection{Построение прогноза}
Построим прогноз ряда потребления электроэнергии $\bx$, используя только его собственную историю, и сравним с прогнозом, строящимся с использованием ряда температуры $\by$.  Рассмотрим также прогнозы, строящиеся при помощи только первых главных компонент ряда $\by$.
На рис. \ref{mse_energy} представлены графики зависимости среднеквадратичной ошибки прогноза от ширины окна $L$. 

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.37]{pictures/energy_temp/forecast_error_diff_Y_comps_5_10.eps}
\caption{Среднеквадратичная ошибка прогноза в зависимости от ширину окна}
\label{mse_energy}
\end{center}
\end{figure}



\subsection{Эксперимент на данных об объеме перевозок нефти}
В эксперименте проверяются связи между тремя временными рядами: объем грузоперевозок нефти $\bx$, цена на нефть $\bh$ и объем добычи нефти $\bq$. 
Временные ряды заданы в период 21 год по месяцам. 
Исходные и продифференцированные ряды представлены на рис.\ref{railroads_init_ts} и рис.\ref{railroads_stat_ts} соответственно.  

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.45]{pictures/railroads_oil/all_ts_init.eps}\caption{Исследуемые временные ряды}
\label{railroads_init_ts}
\end{center}
\end{figure}

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.45]{pictures/railroads_oil/all_ts_stat.eps}
\caption{Исследуемые временные ряды, приведенные к стационарному виду}
\label{railroads_stat_ts}
\end{center}
\end{figure}

Исследуем связи рядов в парах $(\bx, \bh)$ и $(\bx, \bq)$. 
Аналогично предыдущим экспериментам, для проверки наличия связи между рядами смотрим, как точки, близкие в траекторном пространстве одного ряда, отображаются в траекторное подпространство другого ряда.


\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.45]{pictures/railroads_oil/XH_trajectories.eps}
\includegraphics[scale=0.45]{pictures/railroads_oil/HX_trajectories.eps}
\caption{Связи между рядами $\bx$ и $\bh$}
\end{center}
\end{figure}


\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.45]{pictures/railroads_oil/XQ_trajectories.eps}
\includegraphics[scale=0.45]{pictures/railroads_oil/QX_trajectories.eps}
\caption{Связи между рядами $\bx$ и $\bq$}
\end{center}
\end{figure}


Сравним ошибку прогноза ряда $\bx$ с и без использования ряда $\bh$. Когда ряд $\bh$  включен в прогностическую модель рассмотрим два случая:
для прогноза у ряда $\bh$, используются  все компоненты, используются только первые компоненты. 
Аналогично построим прогноз $\bx$ с использованием $\bq$, $\bh$ с использованием $\bx$ и $\bq$ с использованием $\bx$. Результаты эксперимента представлены на рис. \ref{mse_railroads}.

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.31]{pictures/railroads_oil/XH.eps}
\includegraphics[scale=0.31]{pictures/railroads_oil/HX.eps}
\caption{Зависимость ошибки прогноза от ширины окна $L$ для пары рядов $\bx$ и $\bh$.}
\label{mse_railroads}
\end{center}
\end{figure}

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.31]{pictures/railroads_oil/XQ.eps}
\includegraphics[scale=0.31]{pictures/railroads_oil/QX.eps}
\caption{Зависимость ошибки прогноза от ширины окна $L$ для пары рядов $\bx$ и $\bq$.}
\label{mse_railroads}
\end{center}
\end{figure}


\section{Заключение}
В работе решалась задача обнаружения связи между временными рядами, а также между их компонентами. Связи между  временными рядами устанавливались с помощью метода сходящегося перекрестного среднего (CCM). Вывод о наличии связи между парой рядов сравнивался с результатом теста Гренджера, проведенном на этих же рядах. 

Эксперимент проводился на трех наборах данных: искусственные данные, данные потребления электроэнергии, данные РЖД объема грузоперевозок нефти. Для каждого набора данных сделаны выводы о наличии связей между исследуемыми рядами. На данных РЖД видно, что метод CCM более чувствителен к наличию связи между рядами. 

Работа по обнаружению связи между рядами с помощью теста Гренджера "Анализ зависимостей между показателями при прогнозировании объема грузоперевозок" $\,$ подана в журнале  "Системы и средства информатики".









\bibliography{literature}
\bibliographystyle{unsrt}

\end{document} 
